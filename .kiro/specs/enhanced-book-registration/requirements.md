# 拡張書籍登録システム - 要件定義書

## はじめに

既存の図書館管理システムにISBNスキャン機能を活用した、より効率的で包括的な書籍登録システムを実装します。Google Books APIとの連携により、書籍情報の自動取得と在庫管理機能を含む完全な書籍登録フローを提供します。

## 要件

### 要件1: ISBNスキャンによる自動書籍情報取得

**ユーザーストーリー:** 管理者として、ISBNをスキャンまたは入力するだけで書籍の詳細情報を自動取得し、登録作業を大幅に効率化したい

#### 受入基準
1. WHEN 管理者がISBNスキャンページにアクセス THEN システムはカメラ機能付きのISBN入力フォームを表示する
2. WHEN 有効なISBNが入力される THEN システムはGoogle Books APIから書籍情報を取得する
3. WHEN API取得が成功 THEN システムはタイトル、著者、出版社、出版日、説明、表紙画像、ページ数を自動入力する
4. WHEN API取得が失敗 THEN システムは手動入力フォームにフォールバックし、適切なメッセージを表示する
5. WHEN 取得した情報が不完全 THEN 管理者は不足項目を手動で編集できる

### 要件2: 拡張書籍データモデル

**ユーザーストーリー:** システム管理者として、書籍の包括的な情報を保存し、より詳細な検索と管理を可能にしたい

#### 受入基準
1. WHEN 書籍が登録される THEN システムは基本情報（タイトル、著者、ISBN）に加えて拡張情報を保存する
2. WHEN 拡張情報が保存される THEN システムは出版社、出版日、説明文、表紙画像URL、ページ数、言語、ジャンルを含める
3. WHEN Google Books IDが取得される THEN システムは将来の情報更新のためにIDを保存する
4. WHEN 書籍情報が表示される THEN システムは保存された全ての情報を適切にフォーマットして表示する
5. WHEN ジャンル情報が設定される THEN システムは事前定義されたジャンルリストから選択または新規追加を許可する

### 要件3: 在庫管理システム

**ユーザーストーリー:** 図書館スタッフとして、同一書籍の複数冊管理と在庫状況を正確に把握したい

#### 受入基準
1. WHEN 新しい書籍が登録される THEN システムは総在庫数と利用可能数を設定する
2. WHEN 同一ISBNの書籍が再登録される THEN システムは在庫数を増加させる（重複登録ではなく）
3. WHEN 在庫情報が表示される THEN システムは「利用可能数/総在庫数」の形式で表示する
4. WHEN 在庫数が0になる THEN システムは「貸出中」ステータスを表示する
5. WHEN 管理者が在庫を調整 THEN システムは手動での在庫数変更を許可する

### 要件4: 改良された書籍登録フロー

**ユーザーストーリー:** 管理者として、ISBNスキャンから登録完了まで直感的で効率的なワークフローを利用したい

#### 受入基準
1. WHEN 管理者が書籍登録を開始 THEN システムはISBNスキャン/入力画面を表示する
2. WHEN ISBN情報が取得される THEN システムは確認・編集画面に遷移する
3. WHEN 管理者が情報を確認 THEN システムは在庫数設定オプションを提供する
4. WHEN 登録が完了 THEN システムは成功メッセージと共に書籍詳細ページを表示する
5. WHEN エラーが発生 THEN システムは適切なエラーメッセージと回復手段を提供する

### 要件5: 拡張検索機能

**ユーザーストーリー:** 利用者として、書籍の詳細情報を使った多様な検索方法で目的の書籍を見つけたい

#### 受入基準
1. WHEN ユーザーが検索を実行 THEN システムはタイトル、著者、出版社、説明文、ジャンルから検索する
2. WHEN 詳細検索が選択される THEN システムは出版年、言語、ページ数範囲、ジャンルでの絞り込みを提供する
3. WHEN 検索結果が表示される THEN システムは表紙画像、基本情報、在庫状況、ジャンルを含む
4. WHEN 検索結果が多数 THEN システムはページネーションと並び替えオプション（ジャンル、タイトル、出版日）を提供する
5. WHEN 検索履歴が必要 THEN システムは最近の検索キーワードを保存・表示する

### 要件6: 写真アップロード機能

**ユーザーストーリー:** 管理者として、書籍の実物写真をアップロードし、より詳細な書籍情報を提供したい

#### 受入基準
1. WHEN 書籍登録時に写真が利用可能 THEN システムは複数の写真アップロード機能を提供する
2. WHEN 写真がアップロードされる THEN システムは適切なサイズにリサイズし、最適化して保存する
3. WHEN Google Books APIから表紙画像が取得される THEN システムは外部画像とアップロード画像の両方を保持する
4. WHEN 写真が表示される THEN システムはメイン画像とサムネイル画像を適切に表示する
5. WHEN 写真が複数存在 THEN システムは画像ギャラリー機能を提供する

### 要件7: ジャンル分類とソート機能

**ユーザーストーリー:** 利用者として、ジャンル別に書籍を分類・検索し、効率的に目的の書籍を見つけたい

#### 受入基準
1. WHEN 書籍が登録される THEN システムは事前定義されたジャンルから選択または新規ジャンル作成を許可する
2. WHEN ジャンル検索が実行される THEN システムは選択されたジャンルの書籍のみを表示する
3. WHEN 書籍一覧が表示される THEN システムはジャンル、タイトル、著者、出版日でソート機能を提供する
4. WHEN ジャンル管理が必要 THEN 管理者はジャンルの追加、編集、削除ができる
5. WHEN ジャンル統計が必要 THEN システムは各ジャンルの書籍数を表示する

### 要件8: 書籍詳細表示の拡張

**ユーザーストーリー:** 利用者として、書籍の詳細情報を包括的に確認し、貸出可能性を判断したい

#### 受入基準
1. WHEN 書籍詳細ページにアクセス THEN システムは表紙画像、アップロード写真、全ての書籍情報、在庫状況を表示する
2. WHEN 説明文が長い THEN システムは「続きを読む」機能で表示を制御する
3. WHEN 在庫が利用可能 THEN システムは「貸出可能」ステータスを明確に表示する
4. WHEN 関連書籍が存在 THEN システムは同じ著者、出版社、ジャンルの他の書籍を提案する
5. WHEN 管理者がアクセス THEN システムは編集・削除オプションを表示する

## 技術制約

- Laravel 11.x フレームワークを使用
- MySQL データベースを使用
- Google Books API v1を使用
- Tailwind CSS でスタイリング
- Alpine.js でフロントエンド機能
- Laravel Breeze で認証機能
- レスポンシブデザイン対応
- カメラAPI（getUserMedia）でバーコードスキャン対応