# AI連携ガイドライン：学校図書管理システム

## 1. 振る舞いの基本原則
* **「余計なことをしない」**: 指示にない機能の追加提案は厳禁です。
* **「MVP（最小限）重視」**: 常に実用最小限の構成を維持し、意図をそのまま形にすることに集中してください。
* **「勝手に実装しない」**: 改善案であっても、許可なく設計やコードに組み込まないでください。

## 2. 認識の同期（最優先・絶対ルール）
* **実装前の認識確認は必須**: どんなタスクでも、コードを書き始める前に必ずuserと認識を確認してください。
* **勝手な解釈の禁止**: 指示が曖昧で複数の解釈ができる場合は、勝手に進めないでください。
* **1行確認**: 「〇〇という理解で良いですか？」と1行で確認を投げ、合意を得てから作業を開始してください。
* **確認なしの実装は禁止**: 確認を飛ばしてコードを書いた場合、その作業は無効とみなします。

## 3. 指摘と提案の出し方（分離ルール）
* **「指摘」は歓迎、ただし「見出し」のみ**:
    * 改善点や懸念点がある場合は、回答の最後に `---` で区切りを引き、**【懸念点・改善のヒント】** という見出しをつけてください。
    * 内容は **1行ずつの箇条書き（インデックスのみ）** で簡潔に出力してください。
* **深掘りはリクエスト制**:
    * 詳細や解決策は、「〇〇について詳しく教えて」と指示するまで書かないでください。

## 4. 修正・更新のルール（差分最小化）
* **ピンポイント修正の徹底**:
    * 修正を依頼した箇所**以外**（インデント、空行、表記の揺れ、コメント等）を1文字も変更しないでください。
* **差分の明示**:
    * 修正箇所が少ない場合は、全体を再出力せず、修正した周辺ブロックのみを提示してください。

## 5. アウトプット形式
* **簡潔な構造**: 冗長な挨拶、前置き、締めの挨拶（「いかがでしょうか」等）はすべてカットしてください。
* **視認性重視**: 長い文章を避け、表や箇条書きを多用して、一目で理解できるようにしてください。

## 6. プロジェクト技術スタック

| 項目 | 技術 |
|---|---|
| フレームワーク | Laravel 12（PHP） |
| データベース | PostgreSQL（Neon） |
| ホスティング | Render |
| フロントエンド | Blade + Tailwind CSS + Alpine.js |
| 外部API | Google Books API（ISBN検索） |
| コンテナ | Docker / docker-compose |

## 7. ディレクトリ構成の把握
* コントローラ: `app/Http/Controllers/`
* 管理者用コントローラ: `app/Http/Controllers/Admin/`
* モデル: `app/Models/`
* ビュー: `resources/views/`
* ルーティング: `routes/web.php`
* マイグレーション: `database/migrations/`
* ドキュメント: `docs/`

## 8. セキュリティルール
* `dd()` や `dump()` を本番コードに残さない
* LIKE検索では `%` と `_` を必ずエスケープする
* 書籍登録・貸出管理は `admin` ミドルウェアで保護する
* `.env` はGitにコミットしない
* 本番環境では `APP_DEBUG=false`

## 9. Git操作のルール
* **「ステージングして」と言われた場合**: そのチャット内で自分が変更・作成したファイルのみを `git add` する。未関係のファイルを含めない。

## 10. ブランチ戦略

| ブランチ | 用途 |
|---|---|
| `main` | 本番（Renderにデプロイ） |
| `dev` | 開発統合ブランチ |
| `feature/xxx` | 新機能の開発 |
| `fix/xxx` | バグ修正 |
| `hotfix/xxx` | 本番の緊急修正 |

### 開発フロー
1. `dev` から `feature/xxx` または `fix/xxx` を切る
2. 作業・コミット
3. `dev` にマージ
4. 確認OK → `main` にマージ → 本番デプロイ

### コミットメッセージ規約（Conventional Commits）
```
feat: 新機能の説明
fix: バグ修正の説明
docs: ドキュメント変更
style: UI/デザイン変更
refactor: リファクタリング
```

## 11. 開発環境
* ローカル開発: Docker MySQL（`docker compose up`）
* 本番: Neon PostgreSQL（Render環境変数で設定）
* `.env` はローカルMySQL接続用に設定する（本番の認証情報を書かない）
* アプリURL: `http://localhost:8001`
